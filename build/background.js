!function(){function e(){var e=chrome.extension.getURL("options.html");r(function(t){for(var r=!1,n=0,o=t.length;o>n;++n)if(r=e===t[n].url)return chrome.tabs.update(t[n].id,{selected:!0});r===!1&&chrome.tabs.create({url:"options.html"})})}function t(e){return!e||0!==e.frameId}function r(e){return chrome.tabs.query({currentWindow:!0,windowType:"normal"},e)}function n(e,t){for(var r,n=0,o=e.length;o>n;++n)if((r=e[n]).id===t)return r}function o(e){return-1!==e.indexOf("chrome://")}function i(e,t){var r,n,o,i,c=e.targets,s=e.regexes;if(s){for(r=0,n=s.length;n>r;++r)if(s[r].test(t))return!0}else s=e.regexes=[];for(;o=c.shift();)try{if(i=new RegExp(o),s.push(i),i.test(t))return!0}catch(a){}return!1}function c(e,t){var r=[];if(!e||!e.length)return r;t||(t={});for(var n,o=t.enabled,i=t.scripts,c=t.targets,s=0,a=e.length;a>s;++s)if(n=e[s],(!o||n.enabled)&&(!c||n.targets||n.targets.length)){var u=n.css&&n.css.length,f=n.js&&n.js.length;(!i||u||f)&&r.push(n)}return r}function s(e,t,r){var n=r[e];if(n&&!(n.length<1)){var o,i,c,s=t.id,a="js"===e?"executeScript":"insertCSS";for(o=0,i=n.length;i>o;++o)c=n[o],chrome.tabs[a](s,{code:c.code,file:c.filepath,runAt:c.runAt})}}function a(e){t(e)||o(e.url)||r(function(t){var r=e.tabId,o=n(t,r);if(o){var c,a,u,f=o.url;for(c=0,a=h.length;a>c;++c)u=h[c],i(u,f)&&(s("css",o,u),s("js",o,u))}})}function u(e){h=c(e.injector.newValue.rules,{enabled:!0,scripts:!0,targets:!0})}function f(){chrome.webNavigation.onCommitted.addListener(a),chrome.storage.onChanged.addListener(u)}var h;chrome.storage.sync.get("injector",function(e){h=e.injector?e.injector.rules||[]:[],f()}),chrome.browserAction.onClicked.addListener(e)}();