!function(){"use strict";function e(){var e=chrome.extension.getURL("options.html");n(function(t){for(var n=!1,r=0,o=t.length;o>r;++r)if(n=e===t[r].url)return chrome.tabs.update(t[r].id,{selected:!0});n===!1&&chrome.tabs.create({url:"options.html"})})}function t(e){return!e||0!==e.frameId}function n(e){return chrome.tabs.query({windowType:"normal"},e)}function r(e,t){for(var n,r=0,o=e.length;o>r;++r)if((n=e[r]).id===t)return n}function o(e){return-1!==e.indexOf("chrome://")}function i(e,t){var n,r,o,i,a=e.targets,s=e.regexes;if(s){for(n=0,r=s.length;r>n;++n)if(s[n].test(t))return!0}else s=e.regexes=[];for(;o=a.shift();)try{if(i=new RegExp(o),s.push(i),i.test(t))return!0}catch(u){}return!1}function a(e,t){var n=[];if(!e||!e.length)return n;t||(t={});for(var r,o=t.enabled,i=t.scripts,a=t.targets,s=t.runAt,u=0,c=e.length;c>u;++u)if(r=e[u],(!o||r.enabled)&&!(a&&!r.targets&&!r.targets.length||s&&r.runAt!==s)){var l=r.css&&r.css.length,d=r.js&&r.js.length;(!i||l||d)&&n.push(r)}return n}function s(e,t){chrome.tabs.sendMessage(e.id,{command:"apply-rules",rules:t})}function u(e,u){if(!t(u)&&!o(u.url)){var c=f[e];c||(g.runAt=e,c=f[e]=a(d,g),g.runAt=null),c.length&&n(function(e){var t=u.tabId,n=r(e,t);if(n){var o,a,l,d=n.url,f=[];for(o=0,a=c.length;a>o;++o)l=c[o],i(l,d)&&f.push(l);s(n,f)}})}}function c(e){d=e.injector.newValue.rules,f={}}function l(){chrome.webNavigation.onCommitted.addListener(u.bind(null,"page-committed")),chrome.webNavigation.onCompleted.addListener(u.bind(null,"page-completed")),chrome.webNavigation.onDOMContentLoaded.addListener(u.bind(null,"page-dom-content-loaded")),chrome.storage.onChanged.addListener(c)}var d,f={},g={enabled:!0,scripts:!0,targets:!0};chrome.storage.sync.get("injector",function(e){d=e.injector?e.injector.rules||[]:[],l()}),chrome.browserAction.onClicked.addListener(e)}();